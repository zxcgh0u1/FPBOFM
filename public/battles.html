<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>FPBOFM — Бои</title>
  <link rel="stylesheet" href="/styles/base.css"/>
  <link rel="stylesheet" href="/styles/layout.css"/>
</head>
<body>
<header class="topbar"></header>
<main class="container">
  <h1>Битвы</h1>
  <form id="battle-form">
    <input type="number" id="opponentId" placeholder="ID соперника"/>
    <button type="submit">Сразиться</button>
  </form>
  <div id="log"></div>
</main>
<script type="module">
import { http } from '/js/api/http.js';
import { renderHeader } from '/js/header.js';
import { store } from '/js/state/store.js';
await store.ensureAuth();
renderHeader();

document.getElementById('battle-form').onsubmit = async e => {
  e.preventDefault();
  const opponentId = Number(document.getElementById('opponentId').value);
  try {
    const r = await http('/battles/start', { method: 'POST', body: { opponentId } });
    document.getElementById('log').innerHTML = `Победитель — ID ${r.winnerId}`;
  } catch (e) {
    document.getElementById('log').innerHTML = `<span style="color:red;">${e.message}</span>`;
  }
};
</script>
</body>
</html>
