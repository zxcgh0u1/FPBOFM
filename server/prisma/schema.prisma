generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  username     String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  wallet         Wallet?
  inventory      CreatureInstance[]
  tasks          UserTask[]
  battlesAsA     Battle[]           @relation("A")
  battlesAsB     Battle[]           @relation("B")
  lastPassiveAt  DateTime?
  dailyClaimedAt DateTime?
}

model Wallet {
  id      String @id @default(cuid())
  userId  String @unique
  balance Int    @default(0)

  user User @relation(fields: [userId], references: [id])
}

model CreatureSpec {
  id       String  @id @default(cuid())
  name     String  @unique
  rarity   Rarity
  baseHP   Int
  baseATK  Int
  baseDEF  Int
  imageUrl String?
  dropRate Float

  instances CreatureInstance[] // üëà –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
}

enum Rarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
}

model CreatureInstance {
  id       String  @id @default(cuid())
  ownerId  String
  specId   String
  level    Int     @default(1)
  stars    Int     @default(0)
  exp      Int     @default(0)
  isLocked Boolean @default(false)

  owner User         @relation(fields: [ownerId], references: [id])
  spec  CreatureSpec @relation(fields: [specId], references: [id])
}

model GachaProduct {
  id       String    @id @default(cuid())
  type     GachaType
  price    Int
  pityStep Int       @default(0)
}

enum GachaType {
  EGG
  CHEST
}

model Battle {
  id        String   @id @default(cuid())
  aId       String
  bId       String
  result    String
  createdAt DateTime @default(now())

  A User @relation("A", fields: [aId], references: [id])
  B User @relation("B", fields: [bId], references: [id])
}

model Task {
  id     String  @id @default(cuid())
  code   String  @unique
  title  String
  reward Int
  daily  Boolean @default(false)

  userTasks UserTask[] // üëà –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
}

model UserTask {
  id       String    @id @default(cuid())
  userId   String
  taskId   String
  progress Int       @default(0)
  doneAt   DateTime?

  user User @relation(fields: [userId], references: [id])
  task Task @relation(fields: [taskId], references: [id])
}
